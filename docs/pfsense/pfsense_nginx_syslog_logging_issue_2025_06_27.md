# 🛠️ pfSense + nginx syslog logging issue 2025_06_27

[![Join the TrustMindLab Discussions](https://img.shields.io/badge/💬_Join-TrustMindLab-blueviolet)](https://github.com/goAuD/MyHomeLab/discussions/1)

<div class="badge-base LI-profile-badge" data-locale="hu_HU" data-size="medium" data-theme="light" data-type="VERTICAL" data-vanity="viktor-halupka-weiz" data-version="v1"><a class="badge-base__link LI-simple-link" href="https://at.linkedin.com/in/viktor-halupka-weiz?trk=profile-badge">Viktor Halupka</a></div>

## 🔍 Observed Behavior

NGINX was generating recurring errors similar to the following:

```bash
[error] send() failed (54: Connection reset by peer) while logging to syslog, server: unix:/var/run/log
```

This suggested that NGINX was unable to send log messages to the syslog daemon through the expected Unix domain socket (`/var/run/log`). The cause may have involved unavailable or misconfigured local syslog services.

---

## ✅ Temporary Workaround

> **To avoid reliance on syslog, the logging output was redirected to a physical file.**

### Modified section in nginx WebConfigurator config

```ini
error_log /var/log/nginx/error.log warn;
error_log syslog:server=unix:/var/run/log;
# The modified file:
/var/etc/nginx-webConfigurator.conf
```

---

## Following the edit, the configuration was verified with

```bash
nginx -t
```

### Then nginx was restarted using

```bash
/usr/local/etc/rc.d/nginx restart

```

> ### **✅ The error no longer appeared after this change.**

---

### ⚠️ Important Note

> The file `/var/etc/nginx-webConfigurator.conf` is auto-generated by pfSense. Manual changes to this file might be **overwritten upon reboot or GUI-based config changes**.
> Therefore, this workaround may not be persistent unless additional automation is added.

---

## 💡 Suggested Next Steps

- Consider creating a simple shell script that re-applies the correct `error_log` configuration after each system startup.

- Integrate the script into pfSense boot-time tasks (e.g. via cron or `shellcmd`).

- Monitor if future pfSense updates offer GUI-based syslog control for WebConfigurator.

---

## 🧠 Technical Context

- A **Unix domain socket** (e.g. `/var/run/log`) is used for inter-process communication between applications like nginx and syslog.

- If that socket is unavailable or unstable, programs may fail to log unless redirected.

- Logging directly to a file is often a reliable fallback on constrained or non-standard systems.

---

## 📦 Backup Strategy

If a working configuration is achieved, exporting a **pfSense backup** will include the active WebConfigurator state. This can be restored later, assuming no system-level file rewrites interfere.

---

## 📌 Summary

This workaround may be sufficient in the short term for users on older or non-ideal hardware. Longer-term solutions might involve either automating file corrections or migrating to platforms with finer control over nginx behavior.
